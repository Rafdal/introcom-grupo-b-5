*************************************************************************
*	MATH OPERATIONS			math_ops.msa			*
*************************************************************************
	p68h11

	public	op_suma

	rseg	CODE


*************************************************************************
*		# TESTED WORKING STABLE #	Sat 05  18:58		*
*****************************************************************************************
*					OP_SUMA						*
* Descripción: 										*
*	Recibe los dos operandos de una suma, uno de ellos de 16 bits, y el otro de 8	*
*	y la efectua. Si el resultado es mayor a 999, retorna con error (carry C=1)	*
*											*
* Inputs: 										*
*   - op1: [stack] (16 bits)								*
*   - op2: [AccB] (8 bits)								*
* Outputs:										*
*   - result: [stack] (16 bits)								*
*											*
* Casos de error (Carry=1):	result > 999						*
*****************************************************************************************
* [ Y H  ]  0 <-(Y)
* [ Y L  ]  1
* [ PC  H]  2
* [ PC  L]  3
* [ op1 H / res H] 4
* [ op1 L / res L] 5
op_suma	equ	*
	pshy			Backup de registros
	tsy
	pshx
	
	ldx	4,y		cargo el primer operando
	abx			sumo B con X
	cpx	#999		si el resultado es mayor a 999
	bhi	reterr		salgo con error
	clc			si la operacion es exitosa, borro el carry (C=0)
	stx	4,y		Guardo el resultado
	bra	ret_ok		salgo 

reterr	equ	*
	sec			; Pongo el Carry en 1

ret_ok	pulx			; Restore
	puly

	rts


	END